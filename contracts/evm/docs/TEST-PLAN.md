# EVMåˆçº¦å­æ¨¡å— - æµ‹è¯•å¥—ä»¶è§„åˆ’

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-09  
> **æœ€åæ›´æ–°**: 2025-11-10  
> **å­æ¨¡å—**: EVMæ™ºèƒ½åˆçº¦  
> **æµ‹è¯•ç›®æ ‡**: éªŒè¯EVMä¸SVMåŒå‘æ¡¥æ¥

---

## ğŸ“‹ ç›®å½•

1. [æµ‹è¯•ç­–ç•¥](#1-æµ‹è¯•ç­–ç•¥)
2. [å•å…ƒæµ‹è¯•è§„åˆ’](#2-å•å…ƒæµ‹è¯•è§„åˆ’)
3. [é›†æˆæµ‹è¯•è§„åˆ’](#3-é›†æˆæµ‹è¯•è§„åˆ’)
4. [è·¨é“¾æ¡¥æ¥æµ‹è¯•](#4-è·¨é“¾æ¡¥æ¥æµ‹è¯•)
5. [æµ‹è¯•ç¯å¢ƒé…ç½®](#5-æµ‹è¯•ç¯å¢ƒé…ç½®)
6. [æµ‹è¯•æ•°æ®å‡†å¤‡](#6-æµ‹è¯•æ•°æ®å‡†å¤‡)

---

## 1. æµ‹è¯•ç­–ç•¥

### 1.1 æµ‹è¯•åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¨é“¾æ¡¥æ¥æµ‹è¯•                             â”‚  20%
â”‚  - EVM â†’ SVM å®Œæ•´æµç¨‹                    â”‚
â”‚  - SVM â†’ EVM å®Œæ•´æµç¨‹                    â”‚
â”‚  - å¾€è¿”æµ‹è¯•                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é›†æˆæµ‹è¯•                                 â”‚  25%
â”‚  - åˆçº¦é—´äº¤äº’                             â”‚
â”‚  - VAAç”Ÿæˆå’ŒéªŒè¯                         â”‚
â”‚  - TokenBindingéªŒè¯                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•å…ƒæµ‹è¯•                                 â”‚  55%
â”‚  - BridgeCoreå‡½æ•°                        â”‚
â”‚  - TokenVaultå‡½æ•°                        â”‚
â”‚  - ç®¡ç†åŠŸèƒ½                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.2 ä¸SVMå¯¹æ¯”

| æµ‹è¯•ç±»å‹ | SVMå®é™… | EVMè®¡åˆ’ | è¯´æ˜ |
|---------|---------|---------|------|
| **å•å…ƒæµ‹è¯•** | 53ä¸ª (87%) | 50ä¸ª | åŠŸèƒ½å¯¹ç­‰ |
| **é›†æˆæµ‹è¯•** | 6ä¸ª (50%) | 10ä¸ª | å¢åŠ è·¨é“¾åœºæ™¯ |
| **è·¨é“¾æµ‹è¯•** | 8ä¸ª (63%) | 12ä¸ª | EVMâ†”SVMåŒå‘ |
| **æ€»è®¡** | 67ä¸ª (86%) | **72ä¸ª** | ç¡®ä¿åŒå‘æ¡¥æ¥ |

**å…³é”®å·®å¼‚**:
- âœ… **ç§»é™¤**: SVMç‰¹æœ‰çš„ä¸‰æ­¥éª¤VAAæµ‹è¯•ï¼ˆinit_buffer, append_chunkï¼‰
- âœ… **ç®€åŒ–**: åºåˆ—å·ç®¡ç†æµ‹è¯•ï¼ˆEVMè‡ªåŠ¨å¤„ç†ï¼‰
- âœ… **æ–°å¢**: è·¨é“¾æ¡¥æ¥æµ‹è¯•ï¼ˆéªŒè¯EVMâ†”SVMäº’æ“ä½œï¼‰

---

### 1.3 æµ‹è¯•è¦†ç›–ç›®æ ‡

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | ç”¨ä¾‹æ•° | é¢„è®¡æ—¶é—´ |
|---------|-----------|--------|---------|
| **BridgeCoreå•å…ƒ** | 95%ä»£ç  | 20ä¸ª | 10åˆ†é’Ÿ |
| **TokenVaultå•å…ƒ** | 95%ä»£ç  | 30ä¸ª | 15åˆ†é’Ÿ |
| **é›†æˆæµ‹è¯•** | 90%åœºæ™¯ | 10ä¸ª | 10åˆ†é’Ÿ |
| **è·¨é“¾æ¡¥æ¥** | 100%å…³é”®è·¯å¾„ | 12ä¸ª | 20åˆ†é’Ÿ |
| **æ€»è®¡** | - | **72ä¸ª** | **55åˆ†é’Ÿ** |

---

### 1.4 æµ‹è¯•ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | æµ‹è¯•å†…å®¹ | è¯´æ˜ |
|-------|---------|------|
| **P0** | VAAéªŒè¯ã€EVMâ†”SVMåŒå‘æ¡¥æ¥ã€é˜²é‡æ”¾ | æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡ |
| **P1** | TokenBindingéªŒè¯ã€å…‘æ¢æ¯”ç‡éªŒè¯ | é‡è¦åŠŸèƒ½ |
| **P2** | é€Ÿç‡é™åˆ¶ã€æƒé™æ§åˆ¶ã€é”™è¯¯å¤„ç† | è¾…åŠ©åŠŸèƒ½ |
| **P3** | Gasä¼˜åŒ–ã€è¾¹ç•Œæ¡ä»¶ | æ€§èƒ½ä¼˜åŒ– |

---

### 1.5 æµ‹è¯•ç¯å¢ƒ

**æœ¬åœ°ç¯å¢ƒ**:
- Foundryæœ¬åœ°é“¾ï¼ˆChain ID: 65520ï¼‰
- Solana Test Validatorï¼ˆChain ID: 901ï¼‰
- Guardianæ¨¡æ‹Ÿï¼ˆ19ä¸ªæµ‹è¯•å¯†é’¥ï¼‰

**æµ‹è¯•ç½‘ç¯å¢ƒ**:
- Sepoliaï¼ˆChain ID: 11155111ï¼‰
- Solana Devnetï¼ˆChain ID: 901ï¼‰
- çœŸå®Guardianç½‘ç»œ

---

## 2. å•å…ƒæµ‹è¯•è§„åˆ’

### 2.1 BridgeCore.solæµ‹è¯•

#### 2.1.1 publishMessageå‡½æ•°æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| CORE-001 | æ­£å¸¸å‘å¸ƒæ¶ˆæ¯ | è¿”å›åºåˆ—å·ï¼Œå‘å‡ºäº‹ä»¶ | P0 |
| CORE-002 | æ‰‹ç»­è´¹ä¸è¶³ | revert InsufficientFee | P0 |
| CORE-003 | åºåˆ—å·é€’å¢ | æ¯æ¬¡è°ƒç”¨é€’å¢1 | P0 |
| CORE-004 | åˆçº¦æš‚åœæ—¶å‘å¸ƒ | revert BridgePaused | P0 |
| CORE-005 | ç©ºpayload | æ­£å¸¸æ‰§è¡Œ | P1 |
| CORE-006 | å¤§payloadï¼ˆ32KBï¼‰ | æ­£å¸¸æ‰§è¡Œ | P1 |
| CORE-007 | ä¸åŒconsistencyLevel | æ­£ç¡®å­˜å‚¨ | P1 |

**æµ‹è¯•ä»£ç ç¤ºä¾‹**:
```solidity
function testPublishMessage() public {
    bytes memory payload = hex"010203";
    uint256 fee = bridgeCore.messageFee();
    
    vm.expectEmit(true, true, true, true);
    emit LogMessagePublished(
        address(this),
        0,  // sequence
        123,  // nonce
        payload,
        200  // consistencyLevel
    );
    
    uint64 seq = bridgeCore.publishMessage{value: fee}(
        123,
        payload,
        200
    );
    
    assertEq(seq, 0);
}

function testPublishMessage_InsufficientFee() public {
    bytes memory payload = hex"010203";
    
    vm.expectRevert(InsufficientFee.selector);
    bridgeCore.publishMessage{value: 0}(123, payload, 200);
}
```

---

#### 2.1.2 VAAè§£æä¸éªŒè¯æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| CORE-008 | æœ‰æ•ˆVAAè§£æ | æ­£ç¡®è§£ææ‰€æœ‰å­—æ®µ | P0 |
| CORE-009 | æ— æ•ˆVAAæ ¼å¼ | revert InvalidVAA | P0 |
| CORE-010 | ç­¾åæ•°é‡ä¸è¶³ï¼ˆ12ä¸ªï¼‰ | revert InsufficientSignatures | P0 |
| CORE-011 | ç­¾åæ•°é‡è¾¾åˆ°é—¨é™ï¼ˆ13ä¸ªï¼‰ | éªŒè¯é€šè¿‡ | P0 |
| CORE-012 | ç­¾åæ•°é‡è¶…è¿‡é—¨é™ï¼ˆ15ä¸ªï¼‰ | éªŒè¯é€šè¿‡ | P0 |
| CORE-013 | æ— æ•ˆç­¾å | revert InvalidSignature | P0 |
| CORE-014 | Guardian Setä¸åŒ¹é… | revert InvalidGuardianSet | P0 |
| CORE-015 | è¿‡æœŸçš„Guardian Set | revert InvalidGuardianSet | P0 |

**æµ‹è¯•ä»£ç ç¤ºä¾‹**:
```solidity
function testReceiveMessage_ValidVAA() public {
    // æ„é€ æœ‰æ•ˆVAAï¼ˆ13ä¸ªç­¾åï¼‰
    bytes memory vaa = buildValidVAA(
        guardianSet0,
        13,  // 13ä¸ªç­¾å
        payload
    );
    
    bool success = bridgeCore.receiveMessage(vaa);
    
    assertTrue(success);
    bytes32 vaaHash = keccak256(vaa);
    assertTrue(bridgeCore.isVAAConsumed(vaaHash));
}

function testReceiveMessage_InsufficientSignatures() public {
    // æ„é€ VAAï¼ˆåªæœ‰12ä¸ªç­¾åï¼‰
    bytes memory vaa = buildValidVAA(
        guardianSet0,
        12,  // ä¸è¶³é—¨é™
        payload
    );
    
    vm.expectRevert(InsufficientSignatures.selector);
    bridgeCore.receiveMessage(vaa);
}
```

---

#### 2.1.3 é˜²é‡æ”¾æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| CORE-016 | é¦–æ¬¡æäº¤VAA | æˆåŠŸ | P0 |
| CORE-017 | é‡å¤æäº¤ç›¸åŒVAA | revert VAAAlreadyConsumed | P0 |
| CORE-018 | æŸ¥è¯¢æœªæ¶ˆè´¹VAA | è¿”å›false | P0 |
| CORE-019 | æŸ¥è¯¢å·²æ¶ˆè´¹VAA | è¿”å›true | P0 |

---

#### 2.1.4 Guardian Setç®¡ç†æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| CORE-020 | å‡çº§Guardian Set | æ–°Setæ¿€æ´»ï¼Œæ—§Setè®¾ç½®è¿‡æœŸæ—¶é—´ | P0 |
| CORE-021 | æŸ¥è¯¢å½“å‰Guardian Set | è¿”å›æ­£ç¡®ç´¢å¼• | P0 |
| CORE-022 | è¿‡æ¸¡æœŸä½¿ç”¨æ—§Setç­¾å | éªŒè¯é€šè¿‡ | P0 |
| CORE-023 | è¿‡æ¸¡æœŸä½¿ç”¨æ–°Setç­¾å | éªŒè¯é€šè¿‡ | P0 |
| CORE-024 | è¿‡æœŸåä½¿ç”¨æ—§Set | revert InvalidGuardianSet | P0 |
| CORE-025 | æœªæˆæƒå‡çº§ | revertï¼ˆé€šè¿‡VAAéªŒè¯ï¼‰ | P0 |

---

### 2.2 TokenVault.solæµ‹è¯•

#### 2.2.1 lockTokenså‡½æ•°æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| VAULT-001 | æ­£å¸¸é”å®šERC20 | ä»£å¸è½¬å…¥Vaultï¼Œå‘å‡ºäº‹ä»¶ | P0 |
| VAULT-002 | æˆæƒä¸è¶³ | revert (ERC20: insufficient allowance) | P0 |
| VAULT-003 | ä½™é¢ä¸è¶³ | revert (ERC20: transfer amount exceeds balance) | P0 |
| VAULT-004 | è¶…å‡ºå•ç¬”é™é¢ | revert ExceedsRateLimit | P0 |
| VAULT-005 | è¶…å‡ºæ¯æ—¥é™é¢ | revert ExceedsRateLimit | P0 |
| VAULT-006 | æ‰‹ç»­è´¹ä¸è¶³ | revert InsufficientFee | P0 |
| VAULT-007 | æ— æ•ˆç›®æ ‡é“¾ID | revert InvalidChainId | P0 |
| VAULT-008 | åˆçº¦æš‚åœæ—¶é”å®š | revert BridgePaused | P0 |
| VAULT-009 | é›¶é‡‘é¢è½¬è´¦ | revertæˆ–æ­£å¸¸ï¼ˆæ ¹æ®è®¾è®¡ï¼‰ | P1 |
| VAULT-010 | éå¸¸å¤§é‡‘é¢ï¼ˆuint256.maxï¼‰ | æŒ‰é™é¢æ£€æŸ¥ | P1 |

**æµ‹è¯•ä»£ç ç¤ºä¾‹**:
```solidity
function testLockTokens_Success() public {
    uint256 amount = 1000e6;  // 1000 USDC
    
    // æˆæƒ
    usdc.approve(address(vault), amount);
    
    // è®°å½•åˆå§‹ä½™é¢
    uint256 userBalanceBefore = usdc.balanceOf(user);
    uint256 vaultBalanceBefore = usdc.balanceOf(address(vault));
    
    // é”å®šä»£å¸
    vm.expectEmit(true, true, true, true);
    emit TokensLocked(
        transferId,
        address(usdc),
        user,
        amount,
        2,  // Solana
        recipientBytes32
    );
    
    bytes32 transferId = vault.lockTokens{value: 0.001 ether}(
        address(usdc),
        amount,
        2,  // target chain: Solana
        recipientBytes32
    );
    
    // éªŒè¯ä½™é¢å˜åŒ–
    assertEq(usdc.balanceOf(user), userBalanceBefore - amount);
    assertEq(usdc.balanceOf(address(vault)), vaultBalanceBefore + amount);
}

function testLockTokens_ExceedsRateLimit() public {
    uint256 amount = 2_000_000e6;  // 2M USDCï¼Œè¶…è¿‡å•ç¬”é™é¢
    
    usdc.approve(address(vault), amount);
    
    vm.expectRevert(ExceedsRateLimit.selector);
    vault.lockTokens{value: 0.001 ether}(
        address(usdc),
        amount,
        2,
        recipientBytes32
    );
}
```

---

#### 2.2.2 unlockTokenså‡½æ•°æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| VAULT-011 | æ­£å¸¸è§£é”ä»£å¸ | ä»£å¸è½¬ç»™æ¥æ”¶è€… | P0 |
| VAULT-012 | VAAæ— æ•ˆ | revert InvalidVAA | P0 |
| VAULT-013 | VAAå·²æ¶ˆè´¹ | revert VAAAlreadyConsumed | P0 |
| VAULT-014 | Vaultä½™é¢ä¸è¶³ | revert InsufficientBalance | P0 |
| VAULT-015 | é”™è¯¯çš„ä»£å¸åœ°å€ | revert InvalidToken | P0 |
| VAULT-016 | åˆçº¦æš‚åœæ—¶è§£é” | revert BridgePaused | P0 |

---

#### 2.2.3 é€Ÿç‡é™åˆ¶æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| VAULT-022 | å•ç¬”é™é¢è¾¹ç•Œå€¼ | æ­£å¥½ç­‰äºé™é¢æ—¶æˆåŠŸ | P0 |
| VAULT-023 | å•ç¬”é™é¢+1 | revert ExceedsRateLimit | P0 |
| VAULT-024 | ç´¯è®¡åˆ°æ¯æ—¥é™é¢ | æœ€åä¸€ç¬”æˆåŠŸ | P0 |
| VAULT-025 | è¶…è¿‡æ¯æ—¥é™é¢ | revert ExceedsRateLimit | P0 |
| VAULT-026 | 24å°æ—¶åé‡ç½® | é™é¢é‡ç½®ï¼Œå¯å†æ¬¡è½¬è´¦ | P0 |
| VAULT-027 | æ›´æ–°é€Ÿç‡é™åˆ¶ | æ–°é™é¢ç”Ÿæ•ˆ | P1 |

---

### 2.3 ç®¡ç†åŠŸèƒ½æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| ADMIN-001 | Governanceæš‚åœåˆçº¦ | åˆçº¦æš‚åœ | P0 |
| ADMIN-002 | éGovernanceæš‚åœ | revert Unauthorized | P0 |
| ADMIN-003 | Governanceæ¢å¤åˆçº¦ | åˆçº¦æ¢å¤ | P0 |
| ADMIN-004 | è®¾ç½®é€Ÿç‡é™åˆ¶ | æ–°é™é¢ç”Ÿæ•ˆ | P0 |
| ADMIN-005 | éGovernanceè®¾ç½®é™é¢ | revert Unauthorized | P0 |
| ADMIN-006 | æå–æ‰‹ç»­è´¹ | æˆåŠŸæå– | P0 |
| ADMIN-007 | éGovernanceæå– | revert Unauthorized | P0 |
| ADMIN-008 | æå–è¶…è¿‡ä½™é¢ | revert InsufficientBalance | P0 |

---

## 3. é›†æˆæµ‹è¯•è§„åˆ’

### 3.1 BridgeCoreä¸TokenVaulté›†æˆ

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | éªŒè¯ç‚¹ | ä¼˜å…ˆçº§ |
|-------|---------|--------|--------|
| INT-EVM-001 | lockTokens â†’ publishMessage | CPIè°ƒç”¨ã€åºåˆ—å·é€’å¢ | P0 |
| INT-EVM-002 | receiveMessage â†’ unlockTokens | VAAéªŒè¯ã€ä»£å¸è§£é” | P0 |
| INT-EVM-003 | å¤šæ­¥éª¤åŸå­æ€§ | å¤±è´¥å›æ»šã€çŠ¶æ€ä¸€è‡´ | P0 |
| INT-EVM-004 | Guardian Setå‡çº§ | æ–°æ—§Setå¹¶å­˜ | P1 |
| INT-EVM-005 | TokenBindingéªŒè¯æµç¨‹ | æŸ¥è¯¢ã€éªŒè¯ã€æ‰§è¡Œ | P0 |

### 3.2 TokenBindingç®¡ç†æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | éªŒè¯ç‚¹ | ä¼˜å…ˆçº§ |
|-------|---------|--------|--------|
| INT-EVM-006 | æ³¨å†ŒåŒå‘TokenBinding | å‡ºç«™+å…¥ç«™ç»‘å®š | P0 |
| INT-EVM-007 | æ›´æ–°å…‘æ¢æ¯”ç‡ | æ¯”ç‡ä¸€è‡´æ€§éªŒè¯ | P0 |
| INT-EVM-008 | ç¦ç”¨TokenBinding | é˜»æ­¢è·¨é“¾äº¤æ˜“ | P1 |
| INT-EVM-009 | å¤šå¯¹å¤šTokenBinding | ä¸€ä¸ªæºå¸å¤šç›®æ ‡ | P1 |
| INT-EVM-010 | è·¨å¸ç§å…‘æ¢éªŒè¯ | USDCâ†’USDTè®¡ç®— | P0 |

---

## 4. è·¨é“¾æ¡¥æ¥æµ‹è¯•ï¼ˆæ ¸å¿ƒï¼‰

### 4.1 EVM â†’ SVM æ¡¥æ¥æµ‹è¯•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ä»Ethereum/Foundryåˆ°Solanaçš„å®Œæ•´è·¨é“¾æµç¨‹

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | æµç¨‹ | çŠ¶æ€ |
|-------|---------|------|------|
| **BRIDGE-001** | Ethereum â†’ Solana USDC (1:1) | é”å®šâ†’VAAâ†’è§£é” | P0 å¿…é¡» |
| **BRIDGE-002** | Ethereum USDC â†’ Solana USDT | é”å®šâ†’å…‘æ¢â†’è§£é” | P0 å¿…é¡» |
| **BRIDGE-003** | å¤§é¢è½¬è´¦ï¼ˆ100k USDCï¼‰ | é”å®šâ†’VAAâ†’è§£é” | P1 é‡è¦ |
| **BRIDGE-004** | å¤šç”¨æˆ·å¹¶å‘ï¼ˆ3ç”¨æˆ·ï¼‰ | å¹¶å‘é”å®šâ†’è§£é” | P1 é‡è¦ |

**BRIDGE-001è¯¦ç»†æ­¥éª¤**:
```solidity
// æ­¥éª¤1: Ethereumç«¯é”å®šä»£å¸
Test setUp() {
    // éƒ¨ç½²EVMåˆçº¦ï¼ˆFoundryæœ¬åœ°é“¾ï¼ŒChain ID: 65520ï¼‰
    bridgeCore = new BridgeCore();
    vault = new TokenVault(address(bridgeCore));
    usdc = new MockERC20("USDC", "USDC", 6);
    
    // åˆå§‹åŒ–Guardian Setï¼ˆ19ä¸ªæµ‹è¯•å¯†é’¥ï¼‰
    bridgeCore.initialize(0, testGuardians, 0.001 ether);
    
    // æ³¨å†ŒåŒå‘TokenBinding
    vault.registerBidirectionalBinding(
        65520,                          // Foundry
        toBytes32(address(usdc)),
        901,                            // Solana Devnet
        solanaUSDCBytes32,
        1, 1,  // 1:1 rate
        1, 1
    );
}

function testBridge_ETH_to_Solana_USDC() public {
    // 1. ç”¨æˆ·åœ¨Ethereumé”å®š1000 USDC
    usdc.mint(alice, 1000e6);
    vm.startPrank(alice);
    usdc.approve(address(vault), 1000e6);
    
    uint64 seq = vault.lockTokens{value: 0.001 ether}(
        address(usdc),
        1000e6,
        901,                            // Solana Devnet
        solanaUSDCBytes32,
        alicesolanaAddress
    );
    vm.stopPrank();
    
    // éªŒè¯ï¼šä»£å¸å·²é”å®š
    assertEq(usdc.balanceOf(address(vault)), 1000e6);
    assertEq(usdc.balanceOf(alice), 0);
    
    // 2. æ¨¡æ‹ŸGuardianç­¾åVAA
    bytes memory vaa = buildVAAWithGuardianSignatures(
        seq,
        buildTokenTransferPayload(
            1000e6,
            address(usdc),
            65520,
            alicesolanaAddress,
            901,
            solanaUSDCBytes32,
            1000e6,  // targetAmount
            1, 1     // rate
        )
    );
    
    // 3. è°ƒç”¨Solanaåˆçº¦éªŒè¯
    // æ³¨ï¼šè¿™é‡Œéœ€è¦è·¨é“¾è°ƒç”¨çœŸå®Solana Test Validator
    // æˆ–ä½¿ç”¨Solanaç¨‹åºæ¨¡æ‹Ÿå™¨
    (bool success) = callSolanaCompleteTransfer(vaa);
    assertTrue(success);
    
    // 4. éªŒè¯ï¼šAliceåœ¨Solanaæ”¶åˆ°1000 USDC
    // æ³¨ï¼šéœ€è¦æŸ¥è¯¢Solanaé“¾ä¸Šä½™é¢
    uint64 solanaBalance = querySolanaTokenBalance(
        alicesolanaAddress,
        solanaUSDCBytes32
    );
    assertEq(solanaBalance, 1000e6);
}
```

---

### 4.2 SVM â†’ EVM æ¡¥æ¥æµ‹è¯•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ä»Solanaåˆ°Ethereum/Foundryçš„å®Œæ•´è·¨é“¾æµç¨‹

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | æµç¨‹ | çŠ¶æ€ |
|-------|---------|------|------|
| **BRIDGE-005** | Solana â†’ Ethereum USDC (1:1) | é”å®šâ†’VAAâ†’è§£é” | P0 å¿…é¡» |
| **BRIDGE-006** | Solana USDC â†’ Ethereum USDT | é”å®šâ†’å…‘æ¢â†’è§£é” | P0 å¿…é¡» |
| **BRIDGE-007** | Guardianç­¾åéªŒè¯ | 13/19ç­¾åéªŒè¯ | P0 å¿…é¡» |
| **BRIDGE-008** | VAAé˜²é‡æ”¾ | é‡å¤æäº¤å¤±è´¥ | P0 å¿…é¡» |

**BRIDGE-005è¯¦ç»†æ­¥éª¤**:
```solidity
function testBridge_Solana_to_ETH_USDC() public {
    // 1. åœ¨Solanaç«¯é”å®šä»£å¸
    // æ³¨ï¼šéœ€è¦è°ƒç”¨çœŸå®Solanaç¨‹åºæˆ–æ¨¡æ‹Ÿå™¨
    uint64 solanaSeq = callSolanaTransferTokens(
        aliceSolanaKeypair,
        solanaUSDCMint,
        1000e6,
        65520,  // Foundry
        toBytes32(address(usdc)),
        aliceEthAddress
    );
    
    // 2. ç­‰å¾…Guardianç­¾åï¼ˆæ¨¡æ‹Ÿï¼‰
    bytes memory vaa = waitForGuardianVAA(901, solanaSeq);
    
    // éªŒè¯VAAæ ¼å¼
    assertEq(vaa.length, 1072);  // 13ç­¾åVAA
    
    // 3. åœ¨Ethereumç«¯è§£é”ä»£å¸
    // é¢„å…ˆå­˜å…¥Custodyä½™é¢
    usdc.mint(address(vault), 10000e6);
    
    bool success = vault.unlockTokens(vaa);
    assertTrue(success);
    
    // 4. éªŒè¯ï¼šAliceåœ¨Ethereumæ”¶åˆ°1000 USDC
    assertEq(usdc.balanceOf(alice), 1000e6);
    
    // 5. éªŒè¯ï¼šVAAå·²æ¶ˆè´¹
    bytes32 vaaHash = keccak256(vaa);
    assertTrue(bridgeCore.isVAAConsumed(vaaHash));
    
    // 6. éªŒè¯ï¼šé‡å¤æäº¤å¤±è´¥
    vm.expectRevert("VAAAlreadyConsumed");
    vault.unlockTokens(vaa);
}
```

---

### 4.3 å¾€è¿”æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | æµç¨‹ | çŠ¶æ€ |
|-------|---------|------|------|
| **BRIDGE-009** | å®Œæ•´å¾€è¿”ï¼ˆETHâ†’SOLâ†’ETHï¼‰ | åŒå‘å®Œæ•´æµç¨‹ | P0 å¿…é¡» |
| **BRIDGE-010** | è·¨å¸ç§å¾€è¿” | USDCâ†’USDTâ†’USDC | P1 é‡è¦ |
| **BRIDGE-011** | å¤šæ¬¡å¾€è¿” | 3æ¬¡å¾€è¿”å¾ªç¯ | P2 å¯é€‰ |
| **BRIDGE-012** | å¹¶å‘å¾€è¿” | 3ç”¨æˆ·åŒæ—¶å¾€è¿” | P2 å¯é€‰ |

**BRIDGE-009è¯¦ç»†æ­¥éª¤**:
```solidity
function testBridge_RoundTrip() public {
    uint256 initialBalance = 1000e6;
    usdc.mint(alice, initialBalance);
    
    // === ç¬¬ä¸€æ®µï¼šEthereum â†’ Solana ===
    vm.startPrank(alice);
    usdc.approve(address(vault), initialBalance);
    uint64 seq1 = vault.lockTokens{value: 0.001 ether}(
        address(usdc),
        initialBalance,
        901,
        solanaUSDCBytes32,
        aliceSolanaAddress
    );
    vm.stopPrank();
    
    // Guardianç­¾å + Solanaæ¥æ”¶
    bytes memory vaa1 = buildAndSignVAA(seq1, ...);
    callSolanaCompleteTransfer(vaa1);
    
    // éªŒè¯ï¼šAliceåœ¨Solanaæœ‰1000 USDC
    assertEq(querySolanaBalance(...), initialBalance);
    
    // === ç¬¬äºŒæ®µï¼šSolana â†’ Ethereum ===
    // Aliceåœ¨Solanaå‘èµ·å›ä¼ 
    uint64 seq2 = callSolanaTransferTokens(
        aliceSolanaKeypair,
        solanaUSDCMint,
        initialBalance,
        65520,  // å›åˆ°Foundry
        toBytes32(address(usdc)),
        aliceEthAddress
    );
    
    // Guardianç­¾å + Ethereumæ¥æ”¶
    bytes memory vaa2 = waitForGuardianVAA(901, seq2);
    usdc.mint(address(vault), initialBalance);  // é¢„å­˜Custody
    vault.unlockTokens(vaa2);
    
    // éªŒè¯ï¼šAliceåœ¨Ethereumæ¢å¤åˆå§‹ä½™é¢
    assertEq(usdc.balanceOf(alice), initialBalance);
    
    // éªŒè¯ï¼šå¾€è¿”æˆåŠŸï¼Œæ— æŸå¤±ï¼ˆ1:1æ¯”ç‡ï¼‰
    assertTrue(true, "Round trip successful");
}
```

---

### 4.4 å¼‚å¸¸åœºæ™¯æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| BRIDGE-ERR-001 | æ— æ•ˆGuardianç­¾å | revert InvalidSignature | P0 |
| BRIDGE-ERR-002 | ç­¾åæ•°é‡ä¸è¶³ï¼ˆ12ä¸ªï¼‰ | revert InsufficientSignatures | P0 |
| BRIDGE-ERR-003 | é”™è¯¯çš„ç›®æ ‡é“¾ | revert WrongChain | P0 |
| BRIDGE-ERR-004 | TokenBindingä¸å­˜åœ¨ | revert TokenBindingNotFound | P0 |
| BRIDGE-ERR-005 | å…‘æ¢æ¯”ç‡ä¸åŒ¹é… | revert ExchangeRateMismatch | P0 |
| BRIDGE-ERR-006 | Custodyä½™é¢ä¸è¶³ | revert InsufficientCustody | P0 |

---

### 4.5 æµ‹è¯•å·¥å…·æ”¯æŒ

**éœ€è¦çš„æµ‹è¯•å·¥å…·**:
1. **VAA Builder**: æ„é€ å’Œç­¾åVAAï¼ˆ19ä¸ªGuardianå¯†é’¥ï¼‰
2. **Solanaæ¨¡æ‹Ÿå™¨**: æ¨¡æ‹ŸSolanaç¨‹åºè°ƒç”¨
3. **Guardianæ¨¡æ‹Ÿå™¨**: æ¨¡æ‹ŸGuardianç­¾åè¿‡ç¨‹
4. **è·¨é“¾å·¥å…·**: åè°ƒEVMâ†”SVMäº¤äº’

**å®ç°æ–¹å¼**:
```solidity
// test/utils/CrossChainHelper.sol
contract CrossChainHelper {
    // æ„é€ EVMâ†’SVMçš„VAA
    function buildVAAForSolana(...) external returns (bytes memory);
    
    // æ„é€ SVMâ†’EVMçš„VAA  
    function buildVAAForEthereum(...) external returns (bytes memory);
    
    // æ¨¡æ‹ŸGuardianç­¾åï¼ˆ13/19ï¼‰
    function signWithGuardians(...) external returns (bytes memory);
    
    // è°ƒç”¨Solanaç¨‹åºï¼ˆé€šè¿‡RPCæˆ–æ¨¡æ‹Ÿå™¨ï¼‰
    function callSolanaProgram(...) external returns (bool);
    
    // æŸ¥è¯¢SolanaçŠ¶æ€
    function querySolanaState(...) external view returns (bytes memory);
}
```

**æµ‹è¯•ä»£ç ç¤ºä¾‹**:
```solidity
function testIntegration_FullCrossChainFlow() public {
    // æ­¥éª¤1: åœ¨æºé“¾é”å®šä»£å¸
    uint256 amount = 1000e6;
    usdc.approve(address(vault), amount);
    
    bytes32 transferId = vault.lockTokens{value: 0.001 ether}(
        address(usdc),
        amount,
        2,  // Solana
        recipientBytes32
    );
    
    // éªŒè¯ï¼šä»£å¸å·²é”å®š
    assertEq(usdc.balanceOf(address(vault)), amount);
    
    // æ­¥éª¤2: æ¨¡æ‹ŸGuardianç­¾å
    bytes memory vaa = buildVAAFromTransfer(
        transferId,
        guardianSet,
        13  // 13ä¸ªç­¾å
    );
    
    // æ­¥éª¤3: åœ¨ç›®æ ‡é“¾éªŒè¯VAA
    bool success = bridgeCore.receiveMessage(vaa);
    assertTrue(success);
    
    // æ­¥éª¤4: é€šè¿‡TokenBindingè§£é”å¯¹åº”ä»£å¸ï¼ˆæ¨¡æ‹Ÿï¼‰
    // æ³¨ï¼šå®é™…åœ¨Solanaé“¾ä¸Šé€šè¿‡TokenBindingæœºåˆ¶è§£é”
    bytes32 vaaHash = keccak256(vaa);
    assertTrue(bridgeCore.isVAAConsumed(vaaHash));
}
```

---

### 3.2 Guardian Setå‡çº§æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| INT-004 | Guardian Setå‡çº§ | æ–°æ—§Setå…±å­˜7å¤© | P0 |
| INT-005 | å‡çº§æœŸé—´è·¨é“¾ | æ—§Setç­¾åä»æœ‰æ•ˆ | P0 |
| INT-006 | å‡çº§åç«‹å³è·¨é“¾ | æ–°Setç­¾åæœ‰æ•ˆ | P0 |
| INT-007 | è¿‡æœŸåä½¿ç”¨æ—§Set | æ‹’ç» | P0 |

---

### 3.3 å¼‚å¸¸åœºæ™¯æµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|-------|---------|---------|--------|
| INT-008 | é‡å¤æäº¤VAA | ç¬¬äºŒæ¬¡å¤±è´¥ | P0 |
| INT-009 | Gasä¸è¶³å¯¼è‡´å¤±è´¥ | å¯é‡è¯• | P0 |
| INT-010 | åˆçº¦æš‚åœæœŸé—´æ“ä½œ | å…¨éƒ¨æ‹’ç» | P0 |
| INT-011 | å¤šåˆçº¦å¹¶å‘æ“ä½œ | æ— ç«æ€æ¡ä»¶ | P1 |

---

## 4. æµ‹è¯•ç¯å¢ƒé…ç½®

### 4.1 Foundryé…ç½®

```toml
# foundry.toml
[profile.default]
src = "src"
out = "out"
libs = ["lib"]
solc_version = "0.8.20"
optimizer = true
optimizer_runs = 200
via_ir = false

[profile.default.fuzz]
runs = 256
max_test_rejects = 65536

[profile.ci]
fuzz = { runs = 5000 }
invariant = { runs = 1000 }
```

---

### 4.2 æµ‹è¯•ç¯å¢ƒéƒ¨ç½²

```solidity
// test/Setup.sol
contract TestSetup is Test {
    BridgeCore public bridgeCore;
    TokenVault public vault;
    MockERC20 public usdc;
    
    address public governance = address(0x1);
    address public user = address(0x2);
    
    // Guardianå¯†é’¥ï¼ˆæµ‹è¯•ç”¨ï¼‰
    address[] public guardians;
    
    function setUp() public {
        // éƒ¨ç½²åˆçº¦
        bridgeCore = new BridgeCore();
        vault = new TokenVault(address(bridgeCore));
        usdc = new MockERC20("USD Coin", "USDC", 6);
        
        // åˆå§‹åŒ–Guardian Set
        guardians = new address[](19);
        for (uint i = 0; i < 19; i++) {
            guardians[i] = vm.addr(i + 1);
        }
        bridgeCore.initialize(guardians, governance);
        
        // è®¾ç½®æµ‹è¯•è´¦æˆ·
        vm.deal(user, 100 ether);
        usdc.mint(user, 10_000_000e6);  // 10M USDC
    }
}
```

---

### 4.3 Mockåˆçº¦

```solidity
// test/mocks/MockERC20.sol
contract MockERC20 is ERC20 {
    uint8 private _decimals;
    
    constructor(
        string memory name,
        string memory symbol,
        uint8 decimals_
    ) ERC20(name, symbol) {
        _decimals = decimals_;
    }
    
    function mint(address to, uint256 amount) external {
        _mint(to, amount);
    }
    
    function decimals() public view override returns (uint8) {
        return _decimals;
    }
}
```

---

## 5. æµ‹è¯•æ•°æ®å‡†å¤‡

### 5.1 æµ‹è¯•è´¦æˆ·

```solidity
// æµ‹è¯•ç§é’¥ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰
uint256 constant USER_KEY = 0x1234...;
uint256 constant GUARDIAN_0_KEY = 0x5678...;
// ... 19ä¸ªGuardianç§é’¥

// æ´¾ç”Ÿåœ°å€
address user = vm.addr(USER_KEY);
address guardian0 = vm.addr(GUARDIAN_0_KEY);
```

---

### 5.2 æµ‹è¯•VAAæ„é€ 

```solidity
function buildValidVAA(
    address[] memory guardianSet,
    uint8 numSignatures,
    bytes memory payload
) internal returns (bytes memory) {
    // 1. æ„é€ VAA Body
    bytes memory body = abi.encodePacked(
        uint32(block.timestamp),  // timestamp
        uint32(12345),            // nonce
        uint16(1),                // emitterChain
        bytes32(uint256(uint160(address(this)))),  // emitter
        uint64(0),                // sequence
        uint8(200),               // consistencyLevel
        payload
    );
    
    bytes32 bodyHash = keccak256(body);
    
    // 2. Guardianç­¾å
    bytes memory signatures = "";
    for (uint8 i = 0; i < numSignatures; i++) {
        uint256 guardianKey = i + 1;
        (uint8 v, bytes32 r, bytes32 s) = vm.sign(guardianKey, bodyHash);
        
        signatures = abi.encodePacked(
            signatures,
            uint8(i),  // guardianIndex
            r,
            s,
            v
        );
    }
    
    // 3. æ„é€ å®Œæ•´VAA
    return abi.encodePacked(
        uint8(1),             // version
        uint32(0),            // guardianSetIndex
        uint8(numSignatures), // signaturesLength
        signatures,
        body
    );
}
```

---

### 5.3 æµ‹è¯•ä»£å¸

```solidity
// éƒ¨ç½²æµ‹è¯•ä»£å¸
MockERC20 usdc = new MockERC20("USD Coin", "USDC", 6);
MockERC20 usdt = new MockERC20("Tether USD", "USDT", 6);
MockERC20 weth = new MockERC20("Wrapped Ether", "WETH", 18);

// é“¸é€ æµ‹è¯•ä»£å¸
usdc.mint(user1, 10_000_000e6);  // 10M USDC
usdt.mint(user2, 5_000_000e6);   // 5M USDT
weth.mint(user3, 1000e18);       // 1000 WETH
```

---

### 5.4 Chain IDé…ç½®ï¼ˆä¸SVMä¸€è‡´ï¼‰

```solidity
// æœ¬åœ°æµ‹è¯•ä½¿ç”¨å¤§é­”æ•°é¿å…å†²çª
uint16 constant LOCAL_CHAIN_ID = 65520;

// è·¨é“¾ç›®æ ‡
uint16 constant ETHEREUM_MAINNET = 1;
uint16 constant BSC_MAINNET = 56;
uint16 constant POLYGON_MAINNET = 137;
uint16 constant SOLANA_MAINNET = 900;
uint16 constant SOLANA_DEVNET = 901;

// æµ‹è¯•ç½‘
uint16 constant SEPOLIA = 11155111;
uint16 constant BSC_TESTNET = 97;
```

**é‡è¦è¯´æ˜**:
- âœ… ä½¿ç”¨è¡Œä¸šæ ‡å‡†Chain ID (EIP-155, Wormhole)
- âœ… æœ¬åœ°æµ‹è¯•ä½¿ç”¨65520-65535é¿å…å†²çª
- âœ… ä¸SVMå­æ¨¡å—ä¿æŒä¸€è‡´
- âŒ ä¸ä½¿ç”¨Foundryé»˜è®¤çš„31337
- âŒ ä¸ä½¿ç”¨1337ç­‰å¸¸è§ID

**å‚è€ƒ**: [API-SPEC.md - Chain IDè§„èŒƒ](./API-SPEC.md#65-chain-idè§„èŒƒä¸svmä¸€è‡´)

---

## 6. æµ‹è¯•æ‰§è¡Œ

### 6.1 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test

# è¿è¡Œç‰¹å®šåˆçº¦æµ‹è¯•
forge test --match-contract BridgeCoreTest

# è¿è¡Œç‰¹å®šå‡½æ•°æµ‹è¯•
forge test --match-test testPublishMessage

# æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
forge test -vvv

# æ˜¾ç¤ºGasæŠ¥å‘Š
forge test --gas-report

# æ˜¾ç¤ºè¦†ç›–ç‡
forge coverage
```

---

### 6.2 æµ‹è¯•æŠ¥å‘Š

```bash
# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
forge coverage --report lcov
genhtml lcov.info -o coverage/

# æŸ¥çœ‹æŠ¥å‘Š
open coverage/index.html
```

---

## 7. CI/CDé›†æˆ

### 7.1 GitHub Actionsé…ç½®

```yaml
name: EVM Contracts Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive
      
      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1
      
      - name: Run tests
        run: |
          cd contracts/evm
          forge test -vvv
      
      - name: Check coverage
        run: |
          cd contracts/evm
          forge coverage --report summary
```

---

## 8. æµ‹è¯•æŒ‡æ ‡

### 8.1 è¦†ç›–ç‡ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|-----|--------|--------|------|
| è¡Œè¦†ç›–ç‡ | â‰¥95% | 0% | ğŸ“… |
| åˆ†æ”¯è¦†ç›–ç‡ | â‰¥90% | 0% | ğŸ“… |
| å‡½æ•°è¦†ç›–ç‡ | â‰¥100% | 0% | ğŸ“… |

---

### 8.2 æµ‹è¯•å®Œæˆåº¦

| åˆçº¦ | æ€»ç”¨ä¾‹ | å·²å®Œæˆ | é€šè¿‡ | å¤±è´¥ |
|-----|--------|--------|------|------|
| BridgeCore.sol | 25 | 0 | 0 | 0 |
| TokenVault.sol | 20 | 0 | 0 | 0 |
| ç®¡ç†åŠŸèƒ½ | 8 | 0 | 0 | 0 |
| é›†æˆæµ‹è¯• | 13 | 0 | 0 | 0 |
| **æ€»è®¡** | **66** | **0** | **0** | **0** |

---

## é™„å½•

### A. æµ‹è¯•æœ€ä½³å®è·µ

1. **å‘½åè§„èŒƒ**: `test<FunctionName>_<Scenario>`
2. **æ–­è¨€**: ä½¿ç”¨æ˜ç¡®çš„é”™è¯¯æ¶ˆæ¯
3. **éš”ç¦»æ€§**: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
4. **å¯è¯»æ€§**: æ¸…æ™°çš„æ³¨é‡Šå’Œæ­¥éª¤è¯´æ˜
5. **è¾¹ç•Œæµ‹è¯•**: æµ‹è¯•è¾¹ç•Œå€¼å’Œæç«¯æƒ…å†µ

### B. å¸¸ç”¨æµ‹è¯•å·¥å…·å‡½æ•°

```solidity
// æ—¶é—´æ“ä½œ
vm.warp(timestamp);  // è®¾ç½®block.timestamp
vm.roll(blockNumber);  // è®¾ç½®block.number

// è´¦æˆ·æ“ä½œ
vm.prank(user);  // ä¸‹ä¸€ä¸ªè°ƒç”¨ä»¥userèº«ä»½
vm.startPrank(user);  // åç»­è°ƒç”¨éƒ½ä»¥userèº«ä»½
vm.stopPrank();

// ä½™é¢æ“ä½œ
vm.deal(user, 100 ether);  // è®¾ç½®ETHä½™é¢

// æœŸæœ›äº‹ä»¶
vm.expectEmit(true, true, true, true);
emit EventName(args...);

// æœŸæœ›å›æ»š
vm.expectRevert(ErrorSelector);
```

### C. ç›¸å…³æ–‡æ¡£

- [çˆ¶é¡¹ç›®æµ‹è¯•è§„åˆ’](../../../docs/TEST-PLAN.md)
- [Foundryæµ‹è¯•æ–‡æ¡£](https://book.getfoundry.sh/forge/tests)
- [OpenZeppelinæµ‹è¯•åŠ©æ‰‹](https://docs.openzeppelin.com/test-helpers/)

---

**æ–‡æ¡£çŠ¶æ€**: âœ… v1.0 å·²å®Œæˆ  
**ç»´æŠ¤**: EVMåˆçº¦æµ‹è¯•å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-09

