# è·¨é“¾æ¡¥é¡¹ç›® - æµ‹è¯•å¥—ä»¶è§„åˆ’

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.1  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-08  
> **æœ€åæ›´æ–°**: 2025-11-10  
> **æ›´æ–°è¯´æ˜**: æ–‡æ¡£ä¿®è®¢ - å°†æµ‹è¯•é‡ç‚¹ä»wrappedUSDCè½¬ç§»åˆ°TokenBindingæœºåˆ¶

---

## ğŸ“‹ ç›®å½•

1. [æµ‹è¯•ç­–ç•¥](#1-æµ‹è¯•ç­–ç•¥)
2. [æ ¸å¿ƒæµ‹è¯•åœºæ™¯](#2-æ ¸å¿ƒæµ‹è¯•åœºæ™¯)
3. [æµ‹è¯•ç¯å¢ƒé…ç½®](#3-æµ‹è¯•ç¯å¢ƒé…ç½®)
4. [æµ‹è¯•æ•°æ®å‡†å¤‡](#4-æµ‹è¯•æ•°æ®å‡†å¤‡)
5. [CI/CDé›†æˆ](#5-cicdé›†æˆ)

---

## 1. æµ‹è¯•ç­–ç•¥

### 1.1 æµ‹è¯•åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç«¯åˆ°ç«¯æµ‹è¯• (E2E)                         â”‚  15%
â”‚  - å®Œæ•´è·¨é“¾æµç¨‹                           â”‚
â”‚  - åŸå­æ€§ä¿è¯éªŒè¯                         â”‚
â”‚  - Guardianå‡çº§æµ‹è¯•                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¥å£é›†æˆæµ‹è¯•                             â”‚  35%
â”‚  - åˆçº¦ç”¨æˆ·æ¥å£                           â”‚
â”‚  - Guardian/Relayerè§‚æµ‹API                â”‚
â”‚  - æ¨¡å—é—´é›†æˆæ¥å£                         â”‚
â”‚  - æ¥å£é‰´æƒ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•å…ƒæµ‹è¯•                                 â”‚  50%
â”‚  - åˆçº¦å‡½æ•°                               â”‚
â”‚  - Guardian/Relayeræ ¸å¿ƒé€»è¾‘               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.2 æµ‹è¯•è¦†ç›–ç›®æ ‡

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | ç”¨ä¾‹æ•° | é¢„è®¡æ—¶é—´ |
|---------|-----------|--------|---------|
| **E2Eæµ‹è¯•** | 100%å…³é”®æµç¨‹ | 8ä¸ªåœºæ™¯ | 60åˆ†é’Ÿ |
| **æ¥å£æµ‹è¯•** | 80%æ¥å£ | 40ä¸ªç”¨ä¾‹ | 30åˆ†é’Ÿ |
| **å•å…ƒæµ‹è¯•** | 90%ä»£ç  | 80ä¸ªç”¨ä¾‹ | 20åˆ†é’Ÿ |
| **æ€»è®¡** | - | **128ä¸ª** | **110åˆ†é’Ÿ** |

---

### 1.3 æµ‹è¯•ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | æµ‹è¯•å†…å®¹ | è¯´æ˜ |
|-------|---------|------|
| **P0** | è·¨é“¾åŸå­æ€§ã€Guardianå‡çº§åŸå­æ€§ã€TokenBindingè·¨é“¾æµç¨‹ | æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡ |
| **P1** | æ¥å£é‰´æƒã€é”™è¯¯å¤„ç†ã€è¾¹ç•Œæ¡ä»¶ | é‡è¦åŠŸèƒ½ |
| **P2** | æ€§èƒ½æŒ‡æ ‡ã€ç›‘æ§å‘Šè­¦ | è¾…åŠ©åŠŸèƒ½ |

---

## 2. æ ¸å¿ƒæµ‹è¯•åœºæ™¯

### 2.1 ç«¯åˆ°ç«¯æµ‹è¯•åœºæ™¯ (E2E)

#### E2E-001: TokenBindingè·¨é“¾å®Œæ•´æµç¨‹ï¼ˆEthereum â†’ Solanaï¼‰â­â­â­

**æµ‹è¯•ç›®æ ‡**: éªŒè¯åŸºäºTokenBindingæœºåˆ¶çš„ERC20ä»£å¸ä»Ethereumåˆ°Solanaçš„å®Œæ•´è·¨é“¾è½¬è´¦

**å‰ç½®æ¡ä»¶**:
- Ethereumå’ŒSolanaæµ‹è¯•ç¯å¢ƒå·²éƒ¨ç½²
- 19ä¸ªGuardianèŠ‚ç‚¹è¿è¡Œä¸­
- è‡³å°‘1ä¸ªRelayerè¿è¡Œä¸­
- ç”¨æˆ·æŒæœ‰1000æµ‹è¯•USDC

**æµ‹è¯•æ­¥éª¤**:

```
æ­¥éª¤1: Ethereumé”å®šUSDC
  - ç”¨æˆ·è°ƒç”¨ TokenVault.lockTokens(USDC, 1000, 2, solanaRecipient)
  - éªŒè¯: TokensLockedäº‹ä»¶å‘å‡º
  - éªŒè¯: LogMessagePublishedäº‹ä»¶å‘å‡º
  - éªŒè¯: Vaultä½™é¢å¢åŠ 1000 USDC
  - éªŒè¯: ç”¨æˆ·ä½™é¢å‡å°‘1000 USDC

æ­¥éª¤2: Guardianç›‘å¬å¹¶ç­¾å
  - ç­‰å¾…64ä¸ªç¡®è®¤å—ï¼ˆçº¦13åˆ†é’Ÿï¼‰
  - éªŒè¯: 13/19 Guardianè§‚å¯Ÿåˆ°äº‹ä»¶
  - éªŒè¯: 13/19 Guardianå®Œæˆç­¾å
  - æŸ¥è¯¢ GET /v1/vaa/status/1/{emitter}/{sequence}
  - éªŒè¯: status = "ready", signatureCount >= 13

æ­¥éª¤3: è·å–VAA
  - æŸ¥è¯¢ GET /v1/signed_vaa/1/{emitter}/{sequence}
  - éªŒè¯: è¿”å›200çŠ¶æ€ç 
  - éªŒè¯: VAAåŒ…å«13+ä¸ªæœ‰æ•ˆç­¾å
  - éªŒè¯: VAA payloadæ­£ç¡®ç¼–ç 

æ­¥éª¤4: Relayeræäº¤åˆ°Solana
  - Relayerè°ƒç”¨ solana_core.post_vaa(vaa)
  - éªŒè¯: äº¤æ˜“æˆåŠŸ
  - éªŒè¯: PostedVAAè´¦æˆ·åˆ›å»º

æ­¥éª¤5: æ ¹æ®TokenBindingè§£é”/é“¸é€ ç›®æ ‡ä»£å¸
  - ç”¨æˆ·è°ƒç”¨ token_bridge.complete_transfer(vaa)
  - éªŒè¯: TokenBindingéªŒè¯é€šè¿‡ï¼ˆæºä»£å¸ã€ç›®æ ‡ä»£å¸ã€å…‘æ¢æ¯”ç‡åŒ¹é…ï¼‰
  - éªŒè¯: ç›®æ ‡ä»£å¸æ ¹æ®ç»‘å®šé…ç½®è§£é”æˆ–é“¸é€ 
  - éªŒè¯: ç”¨æˆ·åœ¨Solanaæ”¶åˆ°æ­£ç¡®æ•°é‡çš„ç›®æ ‡ä»£å¸ï¼ˆæŒ‰å…‘æ¢æ¯”ç‡è®¡ç®—ï¼‰

æ­¥éª¤6: éªŒè¯çŠ¶æ€
  - éªŒè¯: Ethereumçš„consumedVAAs[vaaHash] = falseï¼ˆä»å¯æŸ¥è¯¢ï¼‰
  - éªŒè¯: Solanaçš„VAAå·²æ ‡è®°ä¸ºæ¶ˆè´¹
  - éªŒè¯: ä½™é¢æ­£ç¡®
```

**æˆåŠŸæ ‡å‡†**:
- âœ… æ‰€æœ‰æ­¥éª¤æ— é”™è¯¯å®Œæˆ
- âœ… ä½™é¢ä¸€è‡´æ€§ï¼šEthereumé”å®š = Solanaé“¸é€ 
- âœ… æ—¶é—´è¦æ±‚ï¼šæ€»æ—¶é—´ < 15åˆ†é’Ÿ

**å¤±è´¥å¤„ç†**:
- å¦‚æœæ­¥éª¤2å¤±è´¥ï¼ˆGuardianç¦»çº¿ï¼‰ï¼ŒéªŒè¯é”™è¯¯æç¤º
- å¦‚æœæ­¥éª¤4å¤±è´¥ï¼ˆRelayerå¤±è´¥ï¼‰ï¼ŒéªŒè¯å¯ä»¥é‡æ–°æäº¤ç›¸åŒVAA
- éªŒè¯åŸå­æ€§ï¼šè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼ˆæºé“¾å¯å›æ»šï¼‰

---

#### E2E-002: TokenBindingåŒå‘è·¨é“¾æµç¨‹ï¼ˆSolana â†’ Ethereumï¼‰â­â­â­

**æµ‹è¯•ç›®æ ‡**: éªŒè¯TokenBindingæœºåˆ¶æ”¯æŒçš„åŒå‘è·¨é“¾è½¬è´¦

**å‰ç½®æ¡ä»¶**:
- E2E-001å·²æˆåŠŸæ‰§è¡Œï¼ˆæˆ–ç‹¬ç«‹è®¾ç½®TokenBindingï¼‰
- ç”¨æˆ·åœ¨SolanaæŒæœ‰ç›®æ ‡é“¾ä»£å¸ï¼ˆé€šè¿‡E2E-001è·¨é“¾è·å¾—æˆ–ç›´æ¥æŒæœ‰ï¼‰

**æµ‹è¯•æ­¥éª¤**:

```
æ­¥éª¤1: Solanaé”å®š/é”€æ¯æºä»£å¸
  - ç”¨æˆ·è°ƒç”¨ token_bridge.transfer_tokens(sourceToken, amount, targetChain, targetToken, recipient)
  - éªŒè¯: æ ¹æ®TokenBindingé…ç½®ï¼Œæºä»£å¸å·²é”å®šæˆ–é”€æ¯
  - éªŒè¯: MessagePublishedæ—¥å¿—å‘å‡º

æ­¥éª¤2: Guardianç›‘å¬å¹¶ç­¾å
  - ç­‰å¾…32ä¸ªç¡®è®¤å—ï¼ˆçº¦15ç§’ï¼‰
  - éªŒè¯: VAAç”Ÿæˆ

æ­¥éª¤3: Relayeræäº¤åˆ°Ethereum
  - Relayerè°ƒç”¨ BridgeCore.receiveMessage(vaa)
  - éªŒè¯: äº¤æ˜“æˆåŠŸ

æ­¥éª¤4: è§£é”åŸç”ŸUSDC
  - TokenVault.unlockTokens(vaa)
  - éªŒè¯: ç”¨æˆ·åœ¨Ethereumæ”¶åˆ°1000 USDC
  - éªŒè¯: Vaulté”å®šä½™é¢å‡å°‘

æ­¥éª¤5: éªŒè¯å®Œæ•´æ€§
  - éªŒè¯: ç”¨æˆ·åœ¨ä¸¤æ¡é“¾ä¸Šçš„æ€»ä½™é¢ä¸å˜
  - éªŒè¯: Vaultä½™é¢ = åˆå§‹çŠ¶æ€
```

**æˆåŠŸæ ‡å‡†**:
- âœ… åŒå‘è·¨é“¾æˆåŠŸ
- âœ… ä½™é¢å®ˆæ’
- âœ… æ—¶é—´ < 2åˆ†é’Ÿ

---

#### E2E-003: è·¨é“¾åŸå­æ€§ä¿è¯æµ‹è¯• â­â­â­

**æµ‹è¯•ç›®æ ‡**: éªŒè¯è·¨é“¾æ¶ˆæ¯çš„åŸå­æ€§ä¿è¯æœºåˆ¶

**æµ‹è¯•åœºæ™¯A: æºé“¾æˆåŠŸï¼Œç›®æ ‡é“¾å¤±è´¥ï¼Œå¯é‡è¯•**

```
æ­¥éª¤1: Ethereumé”å®šä»£å¸ï¼ˆæˆåŠŸï¼‰
  - é”å®š1000 USDC
  - éªŒè¯: ä»£å¸å·²é”å®šï¼Œä¸å¯é€†

æ­¥éª¤2: Guardianç­¾åï¼ˆæˆåŠŸï¼‰
  - VAAç”ŸæˆæˆåŠŸ

æ­¥éª¤3: æ¨¡æ‹ŸRelayeræäº¤å¤±è´¥
  - æ‰‹åŠ¨åœæ­¢Relayer
  - æˆ–æ¨¡æ‹Ÿç›®æ ‡é“¾RPCæ•…éšœ

æ­¥éª¤4: éªŒè¯VAAå¯é‡å¤æäº¤
  - é‡å¯Relayeræˆ–ä½¿ç”¨å¦ä¸€ä¸ªRelayer
  - æäº¤ç›¸åŒçš„VAA
  - éªŒè¯: ç›®æ ‡é“¾æ¥æ”¶æˆåŠŸ
  - éªŒè¯: ä½™é¢æ­£ç¡®

éªŒè¯ç‚¹:
âœ“ æºé“¾æ“ä½œä¸å¯é€†ï¼ˆä»£å¸å·²é”å®šï¼‰
âœ“ VAAæ°¸ä¹…æœ‰æ•ˆï¼ˆå¯é‡è¯•ï¼‰
âœ“ ç›®æ ‡é“¾é˜²é‡æ”¾ï¼ˆVAAåªèƒ½æ¶ˆè´¹ä¸€æ¬¡ï¼‰
âœ“ æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæœ€ç»ˆå¿…ç„¶æˆåŠŸï¼‰
```

**æµ‹è¯•åœºæ™¯B: Guardianéƒ¨åˆ†ç¦»çº¿ï¼Œä»å¯è¾¾æˆå…±è¯†**

```
æ­¥éª¤1: åœæ­¢6ä¸ªGuardianèŠ‚ç‚¹ï¼ˆå‰©ä½™13ä¸ªï¼‰
æ­¥éª¤2: å‘èµ·è·¨é“¾è½¬è´¦
æ­¥éª¤3: éªŒè¯13ä¸ªGuardianè¾¾æˆå…±è¯†
æ­¥éª¤4: éªŒè¯VAAæ­£å¸¸ç”Ÿæˆ
æ­¥éª¤5: éªŒè¯è·¨é“¾æˆåŠŸå®Œæˆ

éªŒè¯ç‚¹:
âœ“ ç³»ç»Ÿå®¹å¿6/19èŠ‚ç‚¹ç¦»çº¿
âœ“ å…±è¯†æœºåˆ¶å·¥ä½œæ­£å¸¸
âœ“ è·¨é“¾ä¸ä¸­æ–­
```

**æµ‹è¯•åœºæ™¯C: ç›®æ ‡é“¾æ¶ˆè´¹å¤±è´¥åé‡è¯•**

```
æ­¥éª¤1: é”å®šä»£å¸ï¼Œç”ŸæˆVAA
æ­¥éª¤2: ç¬¬ä¸€æ¬¡æäº¤VAAï¼ˆæ¨¡æ‹ŸGasä¸è¶³å¤±è´¥ï¼‰
æ­¥éª¤3: ç¬¬äºŒæ¬¡æäº¤ç›¸åŒVAAï¼ˆGaså……è¶³ï¼‰
æ­¥éª¤4: éªŒè¯: ç¬¬äºŒæ¬¡æˆåŠŸ
æ­¥éª¤5: ç¬¬ä¸‰æ¬¡æäº¤ç›¸åŒVAA
æ­¥éª¤6: éªŒè¯: å¤±è´¥ï¼Œæç¤º"VAA already consumed"

éªŒè¯ç‚¹:
âœ“ å¯ä»¥é‡è¯•æäº¤
âœ“ åªèƒ½æˆåŠŸä¸€æ¬¡
âœ“ é˜²æ­¢åŒèŠ±
```

---

#### E2E-004: Guardian Setè·¨é“¾å‡çº§åŸå­æ€§æµ‹è¯• â­â­â­

**æµ‹è¯•ç›®æ ‡**: éªŒè¯Guardian Setåœ¨ä¸¤æ¡é“¾ä¸Šçš„åŒæ­¥å‡çº§

**å‰ç½®æ¡ä»¶**:
- å½“å‰Guardian Setç´¢å¼•ä¸º0ï¼ˆ19ä¸ªèŠ‚ç‚¹ï¼‰
- å‡†å¤‡æ–°çš„Guardian Setï¼ˆ19ä¸ªæ–°èŠ‚ç‚¹ï¼‰

**æµ‹è¯•æ­¥éª¤**:

```
é˜¶æ®µ1: é¢„é€šçŸ¥é˜¶æ®µ
  
  æ­¥éª¤1.1: ç”Ÿæˆå‡çº§VAA
    - æ—§Guardian Setï¼ˆç´¢å¼•0ï¼‰å¯¹å‡çº§æ¶ˆæ¯ç­¾å
    - VAA payloadåŒ…å«æ–°Guardian Setï¼ˆç´¢å¼•1ï¼‰

  æ­¥éª¤1.2: æäº¤åˆ°Ethereum
    - è°ƒç”¨ BridgeCore.updateGuardianSet(vaa)
    - éªŒè¯: newGuardianSetIndex = 1
    - éªŒè¯: æ–°SetçŠ¶æ€ = "pending"ï¼ˆæœªæ¿€æ´»ï¼‰
    - éªŒè¯: æ—§Setä»ç„¶æœ‰æ•ˆ

  æ­¥éª¤1.3: æäº¤åˆ°Solana
    - è°ƒç”¨ solana_core.update_guardian_set(vaa)
    - éªŒè¯: æ–°Setç´¢å¼• = 1
    - éªŒè¯: æ–°SetçŠ¶æ€ = "pending"
    - éªŒè¯: æ—§Setä»ç„¶æœ‰æ•ˆ

  æ­¥éª¤1.4: éªŒè¯ä¸¤æ¡é“¾çŠ¶æ€ä¸€è‡´
    - Ethereum: getCurrentGuardianSetIndex() = 0
    - Solana: getCurrentGuardianSetIndex() = 0
    - ä¸¤æ¡é“¾éƒ½æœ‰ç´¢å¼•1çš„Setä½†æœªæ¿€æ´»

é˜¶æ®µ2: è¿‡æ¸¡æœŸï¼ˆæ–°æ—§Setå¹¶å­˜ï¼‰
  
  æ­¥éª¤2.1: æ¿€æ´»æ–°Setï¼ˆç»Ÿä¸€æ—¶é—´ç‚¹ï¼‰
    - Ethereum: åœ¨åŒºå—é«˜åº¦ H æ¿€æ´»
    - Solana: åœ¨åŒºå—é«˜åº¦ H' æ¿€æ´»
    - è®¾ç½®7å¤©è¿‡æ¸¡æœŸ

  æ­¥éª¤2.2: æµ‹è¯•æ—§Setç­¾åçš„æ¶ˆæ¯
    - å‘èµ·è·¨é“¾è½¬è´¦
    - æ—§Guardian Setï¼ˆç´¢å¼•0ï¼‰ç­¾å
    - éªŒè¯: ä¸¤æ¡é“¾éƒ½æ¥å—

  æ­¥éª¤2.3: æµ‹è¯•æ–°Setç­¾åçš„æ¶ˆæ¯
    - å‘èµ·è·¨é“¾è½¬è´¦
    - æ–°Guardian Setï¼ˆç´¢å¼•1ï¼‰ç­¾å
    - éªŒè¯: ä¸¤æ¡é“¾éƒ½æ¥å—

  æ­¥éª¤2.4: æµ‹è¯•è·¨Setæ¶ˆæ¯ï¼ˆå…³é”®ï¼‰
    - Ethereumå‘é€æ¶ˆæ¯ï¼ˆç´¢å¼•0ç­¾åï¼‰
    - Solanaæ¥æ”¶æ¶ˆæ¯ï¼ˆæ­¤æ—¶Solanaå¯èƒ½å·²ç”¨ç´¢å¼•1ï¼‰
    - éªŒè¯: è¿‡æ¸¡æœŸå†…ä¸¤ä¸ªç´¢å¼•éƒ½æœ‰æ•ˆ
    - éªŒè¯: è·¨é“¾æˆåŠŸ

é˜¶æ®µ3: å®Œå…¨è¿ç§»
  
  æ­¥éª¤3.1: 7å¤©åè¿‡æœŸæ—§Set
    - Ethereum: æ—§Set expirationTimeè®¾ç½®
    - Solana: æ—§Setè¿‡æœŸ

  æ­¥éª¤3.2: æµ‹è¯•æ—§Setç­¾åå¤±è´¥
    - å°è¯•ç”¨æ—§Setç­¾åæ–°æ¶ˆæ¯
    - éªŒè¯: ä¸¤æ¡é“¾éƒ½æ‹’ç»

  æ­¥éª¤3.3: æµ‹è¯•æ–°Setæ­£å¸¸å·¥ä½œ
    - ç”¨æ–°Setç­¾åæ¶ˆæ¯
    - éªŒè¯: è·¨é“¾æˆåŠŸ
```

**åŸå­æ€§éªŒè¯ç‚¹**:
- âœ… ä¸¤æ¡é“¾çš„Guardian Setç‰ˆæœ¬æœ€ç»ˆä¸€è‡´
- âœ… å‡çº§æœŸé—´è·¨é“¾æ¶ˆæ¯ä¸ä¸­æ–­
- âœ… è¿‡æ¸¡æœŸå†…æ–°æ—§Setéƒ½æœ‰æ•ˆï¼ˆ7å¤©ï¼‰
- âœ… æ²¡æœ‰æ—¶é—´çª—å£å¯¼è‡´æ¶ˆæ¯éªŒè¯å¤±è´¥

**å¤±è´¥åœºæ™¯æµ‹è¯•**:
```
åœºæ™¯A: åªåœ¨ä¸€æ¡é“¾å‡çº§
  - åªåœ¨Ethereumæ‰§è¡ŒupdateGuardianSet
  - Solanaä¸æ‰§è¡Œ
  - å‘èµ·è·¨é“¾è½¬è´¦
  - éªŒè¯: æ–°æ¶ˆæ¯ç”¨æ–°Setç­¾å
  - éªŒè¯: Solanaæ‹’ç»ï¼ˆGuardian Setä¸åŒ¹é…ï¼‰

åœºæ™¯B: ä¸¤æ¡é“¾å‡çº§æ—¶é—´å·®å¼‚è¿‡å¤§
  - Ethereumåœ¨Tæ—¶åˆ»å‡çº§
  - Solanaåœ¨T+8å¤©å‡çº§ï¼ˆè¶…è¿‡è¿‡æ¸¡æœŸï¼‰
  - éªŒè¯: ç³»ç»Ÿæ£€æµ‹åˆ°ä¸ä¸€è‡´
  - éªŒè¯: å‘Šè­¦è§¦å‘
```

---

#### E2E-005: é€Ÿç‡é™åˆ¶æµ‹è¯•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯é€Ÿç‡é™åˆ¶ä¿æŠ¤æœºåˆ¶

**æµ‹è¯•æ­¥éª¤**:

```
æ­¥éª¤1: è®¾ç½®é™é¢
  - å•ç¬”é™é¢: 100,000 USDC
  - æ¯æ—¥é™é¢: 500,000 USDC

æ­¥éª¤2: æµ‹è¯•å•ç¬”é™é¢
  - å°è¯•è½¬è´¦ 150,000 USDC
  - éªŒè¯: äº¤æ˜“å¤±è´¥ï¼Œæç¤º"Exceeds single tx limit"

æ­¥éª¤3: æµ‹è¯•æ¯æ—¥é™é¢
  - è½¬è´¦ 100,000 USDCï¼ˆæˆåŠŸï¼‰
  - è½¬è´¦ 100,000 USDCï¼ˆæˆåŠŸï¼‰
  - è½¬è´¦ 100,000 USDCï¼ˆæˆåŠŸï¼‰
  - è½¬è´¦ 100,000 USDCï¼ˆæˆåŠŸï¼‰
  - è½¬è´¦ 100,000 USDCï¼ˆæˆåŠŸï¼Œæ€»è®¡500,000ï¼‰
  - è½¬è´¦ 1 USDCï¼ˆå¤±è´¥ï¼Œæç¤º"Exceeds daily limit"ï¼‰

æ­¥éª¤4: æµ‹è¯•é™é¢é‡ç½®
  - ç­‰å¾…24å°æ—¶æˆ–æ‰‹åŠ¨é‡ç½®æ—¶é—´
  - è½¬è´¦ 100,000 USDC
  - éªŒè¯: æˆåŠŸï¼ˆé™é¢å·²é‡ç½®ï¼‰
```

---

#### E2E-006: ç´§æ€¥æš‚åœæµ‹è¯•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ç´§æ€¥æš‚åœæœºåˆ¶

**æµ‹è¯•æ­¥éª¤**:

```
æ­¥éª¤1: æ­£å¸¸è½¬è´¦ï¼ˆåŸºå‡†ï¼‰
  - è½¬è´¦1000 USDC
  - éªŒè¯: æˆåŠŸ

æ­¥éª¤2: è§¦å‘ç´§æ€¥æš‚åœ
  - æ²»ç†è°ƒç”¨ BridgeCore.setPaused(true)
  - éªŒè¯: paused = true

æ­¥éª¤3: å°è¯•è½¬è´¦
  - è°ƒç”¨ TokenVault.lockTokens()
  - éªŒè¯: å¤±è´¥ï¼Œæç¤º"Bridge is paused"

æ­¥éª¤4: å°è¯•æ¥æ”¶æ¶ˆæ¯
  - Relayeræäº¤VAA
  - éªŒè¯: å¤±è´¥ï¼Œæç¤º"Bridge is paused"

æ­¥éª¤5: æ¢å¤æœåŠ¡
  - æ²»ç†è°ƒç”¨ BridgeCore.setPaused(false)
  - è½¬è´¦1000 USDC
  - éªŒè¯: æˆåŠŸ
```

---

#### E2E-007: å¤šRelayerç«äº‰æµ‹è¯•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯å¤šä¸ªRelayerå¹¶å­˜çš„åœºæ™¯

**æµ‹è¯•æ­¥éª¤**:

```
æ­¥éª¤1: å¯åŠ¨3ä¸ªRelayer
  - Relayer-A, Relayer-B, Relayer-C

æ­¥éª¤2: å‘èµ·è·¨é“¾è½¬è´¦
  - é”å®šä»£å¸ï¼Œç”ŸæˆVAA

æ­¥éª¤3: ä¸‰ä¸ªRelayeråŒæ—¶è·å–VAA
  - ä¸‰ä¸ªRelayeréƒ½è°ƒç”¨Guardian API

æ­¥éª¤4: ç«äº‰æäº¤
  - Relayer-Aå…ˆæäº¤ï¼ˆæˆåŠŸï¼‰
  - Relayer-Båæäº¤ï¼ˆå¤±è´¥ï¼ŒVAAå·²æ¶ˆè´¹ï¼‰
  - Relayer-Cåæäº¤ï¼ˆå¤±è´¥ï¼ŒVAAå·²æ¶ˆè´¹ï¼‰

æ­¥éª¤5: éªŒè¯
  - ç”¨æˆ·æ”¶åˆ°ä»£å¸ï¼ˆåªæœ‰ä¸€æ¬¡ï¼‰
  - Relayer-Bå’ŒRelayer-Cçš„é”™è¯¯æ—¥å¿—æ­£ç¡®
```

---

#### E2E-008: é“¾é‡ç»„åœºæ™¯æµ‹è¯•

**æµ‹è¯•ç›®æ ‡**: éªŒè¯é“¾é‡ç»„æ—¶çš„å¤„ç†

**æµ‹è¯•æ­¥éª¤**:

```
æ­¥éª¤1: å‘èµ·è½¬è´¦
  - åœ¨Ethereumé”å®šä»£å¸
  - äº¤æ˜“åœ¨åŒºå—Nç¡®è®¤

æ­¥éª¤2: Guardianå¼€å§‹è§‚å¯Ÿ
  - ç­‰å¾…10ä¸ªç¡®è®¤å—

æ­¥éª¤3: æ¨¡æ‹Ÿé“¾é‡ç»„
  - å›æ»šåˆ°åŒºå—N-5
  - äº¤æ˜“è¢«é‡æ–°æ‰“åŒ…åˆ°åŒºå—N+10

æ­¥éª¤4: Guardiané‡æ–°è§‚å¯Ÿ
  - Guardianæ£€æµ‹åˆ°é‡ç»„
  - ç­‰å¾…64ä¸ªç¡®è®¤å—åé‡æ–°ç­¾å

æ­¥éª¤5: éªŒè¯VAA
  - VAAåŸºäºé‡ç»„åçš„åŒºå—
  - åºåˆ—å·ä¸å˜
  - è·¨é“¾æ­£å¸¸å®Œæˆ
```

---

### 2.2 æ¥å£æµ‹è¯•åœºæ™¯ (40ä¸ªç”¨ä¾‹)

#### 2.2.1 åˆçº¦ç”¨æˆ·æ¥å£æµ‹è¯• (16ä¸ªç”¨ä¾‹)

**EVMåˆçº¦æµ‹è¯•**:

| æµ‹è¯•ID | æ¥å£ | æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ |
|-------|------|---------|--------|
| API-EVM-001 | publishMessage | æ­£å¸¸å‘å¸ƒæ¶ˆæ¯ | P0 |
| API-EVM-002 | publishMessage | æ‰‹ç»­è´¹ä¸è¶³ | P0 |
| API-EVM-003 | publishMessage | åºåˆ—å·é€’å¢ | P0 |
| API-EVM-004 | receiveMessage | æ­£å¸¸æ¥æ”¶VAA | P0 |
| API-EVM-005 | receiveMessage | VAAé‡å¤æ¶ˆè´¹ | P0 |
| API-EVM-006 | receiveMessage | æ— æ•ˆç­¾å | P0 |
| API-EVM-007 | lockTokens | æ­£å¸¸é”å®šERC20 | P0 |
| API-EVM-008 | lockTokens | æˆæƒä¸è¶³ | P0 |
| API-EVM-009 | lockTokens | è¶…å‡ºå•ç¬”é™é¢ | P1 |
| API-EVM-010 | unlockTokens | æ­£å¸¸è§£é” | P0 |
| API-EVM-011 | unlockTokens | ä½™é¢ä¸è¶³ | P0 |
| API-EVM-012 | mint/burn | åŒ…è£…ä»£å¸é“¸é€  | P0 |
| API-EVM-013 | getCurrentGuardianSetIndex | æŸ¥è¯¢Guardian Set | P1 |
| API-EVM-014 | isVAAConsumed | æŸ¥è¯¢VAAçŠ¶æ€ | P1 |

**Solanaç¨‹åºæµ‹è¯•**:

| æµ‹è¯•ID | æ¥å£ | æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ |
|-------|------|---------|--------|
| API-SOL-001 | post_message | æ­£å¸¸å‘å¸ƒæ¶ˆæ¯ | P0 |
| API-SOL-002 | post_vaa | æ­£å¸¸æ¥æ”¶VAA | P0 |
| API-SOL-003 | post_vaa | ç­¾åéªŒè¯å¤±è´¥ | P0 |
| API-SOL-004 | transfer_tokens | é”å®šSPLä»£å¸ | P0 |
| API-SOL-005 | complete_transfer | å®Œæˆè½¬è´¦ | P0 |

---

#### 2.2.2 Guardianè§‚æµ‹APIæµ‹è¯• (8ä¸ªç”¨ä¾‹)

| æµ‹è¯•ID | æ¥å£ | æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ |
|-------|------|---------|--------|
| API-GD-001 | GET /v1/signed_vaa | VAAå·²å°±ç»ªï¼Œè¿”å›200 | P0 |
| API-GD-002 | GET /v1/signed_vaa | VAAèšåˆä¸­ï¼Œè¿”å›202 | P0 |
| API-GD-003 | GET /v1/signed_vaa | VAAä¸å­˜åœ¨ï¼Œè¿”å›404 | P0 |
| API-GD-004 | GET /v1/vaa/status | æŸ¥è¯¢èšåˆçŠ¶æ€ | P1 |
| API-GD-005 | GET /v1/guardian/health | å¥åº·æ£€æŸ¥æ­£å¸¸ | P0 |
| API-GD-006 | GET /v1/guardian/health | Guardianç¦»çº¿æ£€æµ‹ | P1 |
| API-GD-007 | GET /v1/guardian/metrics | PrometheusæŒ‡æ ‡ | P2 |
| API-GD-008 | POST /v1/admin/guardian/sign | æ‰‹åŠ¨è§¦å‘ç­¾åï¼ˆéœ€é‰´æƒï¼‰ | P1 |

---

#### 2.2.3 Relayerè§‚æµ‹APIæµ‹è¯• (6ä¸ªç”¨ä¾‹)

| æµ‹è¯•ID | æ¥å£ | æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ |
|-------|------|---------|--------|
| API-RL-001 | POST /v1/relayer/submit | æäº¤VAAæˆåŠŸ | P0 |
| API-RL-002 | POST /v1/relayer/submit | æ— æ•ˆVAA | P0 |
| API-RL-003 | GET /v1/relayer/task | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ | P1 |
| API-RL-004 | GET /v1/relayer/task | ä»»åŠ¡ä¸å­˜åœ¨ | P1 |
| API-RL-005 | GET /v1/relayer/health | å¥åº·æ£€æŸ¥ | P0 |
| API-RL-006 | GET /v1/relayer/health | Relayeræ•…éšœæ£€æµ‹ | P1 |

---

#### 2.2.4 æ¥å£é‰´æƒæµ‹è¯• (10ä¸ªç”¨ä¾‹)

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ |
|-------|---------|--------|
| AUTH-001 | Guardianç®¡ç†æ¥å£ï¼šæ— Tokenè®¿é—® â†’ 401 | P0 |
| AUTH-002 | Guardianç®¡ç†æ¥å£ï¼šæ— æ•ˆToken â†’ 401 | P0 |
| AUTH-003 | Guardianç®¡ç†æ¥å£ï¼šTokenè¿‡æœŸ â†’ 401 | P0 |
| AUTH-004 | Guardianç®¡ç†æ¥å£ï¼šIPä¸åœ¨ç™½åå• â†’ 403 | P0 |
| AUTH-005 | Guardianç®¡ç†æ¥å£ï¼šæœ‰æ•ˆToken+ç™½åå•IP â†’ 200 | P0 |
| AUTH-006 | åˆçº¦ç®¡ç†å‘˜æ¥å£ï¼šéGovernanceè°ƒç”¨ â†’ revert | P0 |
| AUTH-007 | åˆçº¦ç®¡ç†å‘˜æ¥å£ï¼šGovernanceè°ƒç”¨ â†’ æˆåŠŸ | P0 |
| AUTH-008 | å…¬å¼€æ¥å£ï¼šæ— éœ€é‰´æƒè®¿é—® â†’ 200 | P1 |
| AUTH-009 | Relayeræäº¤ï¼šä»»ä½•äººå¯è°ƒç”¨ï¼ˆåˆçº¦éªŒè¯VAAï¼‰ | P0 |
| AUTH-010 | é‰´æƒæ—¥å¿—ï¼šè®°å½•æ‰€æœ‰é‰´æƒå¤±è´¥å°è¯• | P2 |

---

### 2.3 å•å…ƒæµ‹è¯•åœºæ™¯ (80ä¸ªç”¨ä¾‹)

**è¯´æ˜**: å•å…ƒæµ‹è¯•ç”±å¼€å‘äººå‘˜ç¼–å†™ï¼Œè¦†ç›–æ‰€æœ‰åˆçº¦å‡½æ•°å’Œå…³é”®é€»è¾‘è·¯å¾„

**åˆ†ç±»**:
- EVMåˆçº¦å•å…ƒæµ‹è¯•: 40ä¸ª
- Solanaç¨‹åºå•å…ƒæµ‹è¯•: 20ä¸ª
- GuardianæœåŠ¡å•å…ƒæµ‹è¯•: 12ä¸ª
- RelayeræœåŠ¡å•å…ƒæµ‹è¯•: 8ä¸ª

**è¦†ç›–ç‡è¦æ±‚**: â‰¥ 90%

---

## 3. æµ‹è¯•ç¯å¢ƒé…ç½®

### 3.1 æœ¬åœ°æµ‹è¯•ç¯å¢ƒ

```yaml
docker-compose.test.yml:
  services:
    # åŒºå—é“¾èŠ‚ç‚¹
    hardhat:
      image: node:18
      command: npx hardhat node
      ports: ["8545:8545"]
    
    solana:
      image: solanalabs/solana:latest
      command: solana-test-validator
      ports: ["8899:8899"]
    
    # æ•°æ®åº“
    postgres:
      image: postgres:15
      environment:
        POSTGRES_DB: bridge_test
    
    redis:
      image: redis:7
    
    # GuardianèŠ‚ç‚¹ï¼ˆå¯åŠ¨3ä¸ªæ¨¡æ‹Ÿ19ä¸ªï¼‰
    guardian-0:
      build: ./guardian
      environment:
        GUARDIAN_INDEX: 0
        GUARDIAN_KEY: ${GUARDIAN_0_KEY}
    
    guardian-1:
      build: ./guardian
      environment:
        GUARDIAN_INDEX: 1
    
    guardian-2:
      build: ./guardian
      environment:
        GUARDIAN_INDEX: 2
    
    # Relayer
    relayer:
      build: ./relayer
```

---

### 3.2 æµ‹è¯•ç½‘ç¯å¢ƒ

**æ”¯æŒçš„æµ‹è¯•ç½‘**:
- Ethereum: Sepolia
- BSC: BSC Testnet
- Solana: Devnet

**GuardianèŠ‚ç‚¹**: 5ä¸ªï¼ˆæ¨¡æ‹Ÿ19ä¸ªï¼Œé—¨é™è°ƒæ•´ä¸º3/5ï¼‰

---

## 4. æµ‹è¯•æ•°æ®å‡†å¤‡

### 4.1 æµ‹è¯•è´¦æˆ·

```yaml
test_accounts:
  admin: "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"
  user1: "0x5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed"
  user2: "0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199"
  
  solana_user1: "7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"
  solana_user2: "GjQPKZw1JuQqnMEYcxCVR2TfZZqUCpKgz5PQsYm2TmgP"
```

---

### 4.2 æµ‹è¯•ä»£å¸ï¼ˆåŸºäºTokenBindingï¼‰

**æµ‹è¯•USDC**ï¼ˆç”¨äºTokenBindingæµ‹è¯•ï¼‰:
```yaml
ethereum_usdc:
  address: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"
  decimals: 6
  test_supply: 1000000000000  # 1M USDC
  
solana_usdc:
  address: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
  decimals: 6
  test_supply: 1000000000000  # 1M USDCï¼ˆåŸç”Ÿæˆ–é¢„é“¸é€ ï¼‰

token_binding:
  source_chain: 1  # Ethereum
  source_token: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"
  target_chain: 900  # Solana
  target_token: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
  rate_numerator: 1
  rate_denominator: 1  # 1:1å…‘æ¢
  enabled: true
```

---

### 4.3 Guardianå¯†é’¥

```yaml
guardian_keys:
  - private_key: "0x4f3edf983ac636a65a842ce7c78d9aa706d3b113bce9c46f30d7d21715b23b1d"
    address: "0x5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed"
    index: 0
  
  - private_key: "0x6cbed15c793ce57650b9877cf6fa156fbef513c4e6134f022a85b1ffdd59b2a1"
    address: "0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199"
    index: 1
  
  # ... 19ä¸ªGuardian
```

---

## 5. CI/CDé›†æˆ

### 5.1 GitHub Actionså·¥ä½œæµ

```yaml
name: Test Suite

on: [push, pull_request]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run EVM tests
        run: forge test -vvv
      - name: Run Solana tests
        run: anchor test
      - name: Upload coverage
        run: bash <(curl -s https://codecov.io/bash)
  
  integration-tests:
    runs-on: ubuntu-latest
    services:
      postgres: ...
      redis: ...
    steps:
      - name: Start test environment
        run: docker-compose -f docker-compose.test.yml up -d
      - name: Run integration tests
        run: npm run test:integration
  
  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy contracts
        run: ./scripts/deploy/deploy-test.sh
      - name: Start Guardian nodes
        run: docker-compose -f docker-compose.test.yml up -d guardian-0 guardian-1 guardian-2
      - name: Run E2E tests
        run: npm run test:e2e
      - name: Upload test artifacts
        if: failure()
        uses: actions/upload-artifact@v3
```

---

### 5.2 æµ‹è¯•æŠ¥å‘Š

**æ ¼å¼**: Allure Report

**åŒ…å«å†…å®¹**:
- æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç»“æœ
- è¦†ç›–ç‡ç»Ÿè®¡
- æ€§èƒ½æŒ‡æ ‡
- å¤±è´¥ç”¨ä¾‹è¯¦æƒ…
- å†å²è¶‹åŠ¿å¯¹æ¯”

---

### 5.3 æµ‹è¯•æŒ‡æ ‡è¿½è¸ª

```yaml
metrics:
  e2e_tests:
    total: 8
    passed: 8
    failed: 0
    duration: 60m
  
  interface_tests:
    total: 40
    passed: 40
    failed: 0
    duration: 30m
  
  unit_tests:
    total: 80
    passed: 80
    failed: 0
    coverage: 92%
    duration: 20m
  
  overall:
    total: 128
    passed: 128
    failed: 0
    success_rate: 100%
    total_duration: 110m
```

---

## é™„å½•

### A. æµ‹è¯•ç”¨ä¾‹ä¼˜å…ˆçº§è¯´æ˜

| ä¼˜å…ˆçº§ | è¯´æ˜ | æ‰§è¡Œé¢‘ç‡ |
|-------|------|---------|
| **P0** | æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡æ‰èƒ½å‘å¸ƒ | æ¯æ¬¡æäº¤ |
| **P1** | é‡è¦åŠŸèƒ½ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ | æ¯æ—¥æ„å»º |
| **P2** | è¾…åŠ©åŠŸèƒ½ï¼Œä¸å½±å“æ ¸å¿ƒæµç¨‹ | æ¯å‘¨æ„å»º |

---

### B. æµ‹è¯•ç¯å¢ƒæ¸…ç†

**æ¯æ¬¡æµ‹è¯•å**:
```bash
# æ¸…ç†æ•°æ®åº“
docker-compose exec postgres psql -c "TRUNCATE TABLE vaa_records CASCADE"

# é‡ç½®åˆçº¦çŠ¶æ€
forge script script/Reset.s.sol --broadcast

# æ¸…ç†Redisç¼“å­˜
docker-compose exec redis redis-cli FLUSHDB
```

---

### C. æµ‹è¯•æ•°æ®ç”Ÿæˆå·¥å…·

```typescript
// test/utils/dataGenerator.ts
export class TestDataGenerator {
  static generateVAA(options?: Partial<VAAOptions>): Buffer {
    // ç”Ÿæˆæµ‹è¯•VAA
  }
  
  static generateGuardianSet(count: number = 19): GuardianSet {
    // ç”Ÿæˆæµ‹è¯•Guardian Set
  }
  
  static generateTokenTransferPayload(
    token: string,
    amount: bigint,
    recipient: string
  ): Buffer {
    // ç”Ÿæˆä»£å¸è½¬è´¦payload
  }
}
```

---

**æ–‡æ¡£çŠ¶æ€**: âœ… v2.0 å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥**: æ›´æ–°PROGRESS.md
